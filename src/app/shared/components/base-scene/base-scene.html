<a-scene 
  #scene
  background="transparent: true"
  xr-mode-ui="XRMode: ar;"
  webxr="optionalFeatures: anchors,local-floor,bounded-floor,hand-tracking;"
>
  <!-- Default sky - hidden in AR for passthrough, visible on desktop -->
  <a-sky 
    color="#1a1a2e"
    hide-on-enter-ar
  ></a-sky>

  <!-- Wall Environment with calibrated anchor -->
  <a-entity 
    id="wall-environment" 
    position="0 0 0"
    [attr.visible]="visible()"
    calibrated-anchor="storageKey: wall-calibration"
  >
    <!-- Wall GLTF Model - uses direct URL loading like the working playground -->
    @if (wallModelUrl()) {
      <a-entity 
        id="wall-container"
        class="wall interactable"
        [attr.gltf-model]="'url(' + wallModelUrl() + ')'"
        position="0 0 0"
      ></a-entity>
    }

    <!-- Route Holds - colored spheres for selected routes -->
    <a-entity route-hold-renderer></a-entity>

    <!-- All Holds - glowing white spheres with hover/keyboard selection -->
    <!-- wave-animator: one-shot wave effect on edit mode enter -->
    <!-- hold-pulser: continuous emissive glow during edit mode -->
    <!-- mode-hold-colorizer: orange in route modes, green otherwise -->
    <a-entity 
      #holdsContainer
      id="holds-container"
      wave-animator="selector: .hold; waveDuration: 600"
      hold-pulser="selector: .hold; minIntensity: 0.2; maxIntensity: 0.9; pulseDuration: 1200; emissiveColor: #ff6600"
      mode-hold-colorizer="selector: .hold"
    >
      @for (hold of holds(); track hold.id) {
        <a-sphere
          class="hold interactable"
          [attr.data-hold-id]="hold.id"
          [attr.selected-hold]="'holdId: ' + hold.id"
          [attr.position]="hold.x + ' ' + hold.y + ' ' + hold.z"
          radius="0.04"
          animation__grow="property: scale; to: 1.4 1.4 1.4; dur: 150; easing: easeOutQuad; startEvents: mouseenter"
          animation__shrink="property: scale; to: 1 1 1; dur: 150; easing: easeOutQuad; startEvents: mouseleave">
        </a-sphere>
      }
    </a-entity>

    <!-- Extension point: context-specific entities -->
    <ng-content select="[slot=entities]" />
  </a-entity>

  <!-- Extension point: environment (sky, lights, etc) -->
  <ng-content select="[slot=environment]" />

  <!-- Extension point: camera rig (desktop vs VR have different setups) -->
  <ng-content select="[slot=camera]" />
</a-scene>

<!-- 2D overlay slot for desktop features -->
<ng-content select="[slot=overlay]" />
