<a-scene 
  #scene
  xr-mode-ui="XRMode: ar;"
  webxr="optionalFeatures: anchors,local-floor,bounded-floor,hand-tracking;"
>
  <!-- Dark sky for desktop mode - hide in AR or when skybox is None for full passthrough -->
  <a-sky 
    color="#222"
    [attr.visible]="settingsStore.selectedSkyboxPath() !== ''"
  ></a-sky>

  <!-- Wall Environment with calibrated anchor -->
  <a-entity 
    id="wall-environment" 
    position="0 0 0"
    [attr.visible]="visible()"
    calibrated-anchor="storageKey: wall-calibration"
  >
    <!-- Wall GLTF Model - uses direct URL loading like the working playground -->
    @if (wallModelUrl()) {
      <a-entity 
        id="wall-container"
        [attr.gltf-model]="'url(' + wallModelUrl() + ')'"
        [attr.wall-opacity]="'opacity: ' + settingsStore.wallOpacity()"
        position="0 0 0"
      ></a-entity>
    }

    <!-- Route Holds - colored spheres for selected routes -->
    @for (routeHold of routeHoldsToRender(); track routeHold.holdId + '-' + routeHold.routeId) {
      <a-sphere
        class="route-hold"
        [attr.position]="routeHold.position.x + ' ' + routeHold.position.y + ' ' + routeHold.position.z"
        radius="0.06"
        [attr.material]="'color: ' + routeHold.color + '; emissive: ' + routeHold.color + '; emissiveIntensity: 0.8; opacity: 0.85; transparent: true'">
      </a-sphere>
    }

    <!-- All Holds - glowing white spheres with hover/keyboard selection -->
    <!-- Wrapped in container with wave-animator for edit mode visual feedback -->
    <a-entity 
      #holdsContainer
      id="holds-container"
      wave-animator="selector: .hold; waveDuration: 600; pulseEnabled: true; pulseScale: 1.2; pulseDuration: 1000"
    >
      @for (hold of holds(); track hold.id) {
        <a-sphere
          class="hold interactable"
          [attr.data-hold-id]="hold.id"
          [attr.position]="hold.x + ' ' + hold.y + ' ' + hold.z"
          radius="0.04"
          [attr.material]="getHoldMaterial(hold.id)"
          (mouseenter)="onHoldHover(hold.id)"
          (mouseleave)="onHoldHoverEnd(hold.id)">
        </a-sphere>
      }
    </a-entity>

    <!-- Extension point: context-specific entities -->
    <ng-content select="[slot=entities]" />
  </a-entity>

  <!-- Mouse cursor for desktop raycasting (enables mouseenter/mouseleave on entities) -->
  <a-entity 
    id="mouseCursor" 
    cursor="rayOrigin: mouse; fuse: false" 
    raycaster="objects: .interactable, .hold; far: 100">
  </a-entity>

  <!-- Extension point: environment (sky, lights, etc) -->
  <ng-content select="[slot=environment]" />
</a-scene>

<!-- 2D overlay slot for desktop features -->
<ng-content select="[slot=overlay]" />
